<!DOCTYPE html>
<html>
    <head>
        <title>Slot Finder</title>
        <meta charset="UTF-8">
        <meta name="author" content="Amal">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>
            /*            body {
                            background: radial-gradient(1.5em 6.28571em at 1.95em, rgba(255, 255, 255, 0) 50%, rgba(255, 255, 255, 0.25) 50%, rgba(255, 255, 255, 0.25) 55%, rgba(255, 255, 255, 0) 55%) 0 0, radial-gradient(1.5em 6.28571em at -0.45em, rgba(255, 255, 255, 0) 50%, rgba(255, 255, 255, 0.25) 50%, rgba(255, 255, 255, 0.25) 55%, rgba(255, 255, 255, 0) 55%) 1.5em 5.5em, radial-gradient(2.3em 4.57143em at 2.99em, rgba(255, 255, 255, 0) 50%, rgba(255, 255, 255, 0.3) 50%, rgba(255, 255, 255, 0.3) 55%, rgba(255, 255, 255, 0) 55%) 0 0, radial-gradient(2.3em 4.57143em at -0.69em, rgba(255, 255, 255, 0) 50%, rgba(255, 255, 255, 0.3) 50%, rgba(255, 255, 255, 0.3) 55%, rgba(255, 255, 255, 0) 55%) 2.3em 4em, radial-gradient(3.5em 6.28571em at 4.55em, rgba(255, 255, 255, 0) 50%, rgba(255, 255, 255, 0.25) 50%, rgba(255, 255, 255, 0.25) 55%, rgba(255, 255, 255, 0) 55%) 0 0, radial-gradient(3.5em 6.28571em at -1.05em, rgba(255, 255, 255, 0) 50%, rgba(255, 255, 255, 0.25) 50%, rgba(255, 255, 255, 0.25) 55%, rgba(255, 255, 255, 0) 55%) 3.5em 5.5em, radial-gradient(#15ffa5, #00ced1);
                            background-color: mediumspringgreen;
                            background-size: 1.5em 11em, 1.5em 11em, 2.3em 8em, 2.3em 8em, 3.5em 11em, 3.5em 11em, 100% 100%;
                            background-repeat: repeat;
                        }*/
        </style>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"  >

    </head>
    <body>
        <h1 style="text-align: center;">Vaccine Slot Availability Notifier</h1><hr/>
        <!--<hr/>-->
        <form  autocomplete="off">
            <div class="row col-md-12">
                <div class="col-md-2 col-sm-12 col-xs-12">
                      <input type="radio" class="all" name="district_name" value="" checked="checked">
                      <label for="html">None</label><br>
                      <input type="radio" id="Alappuzha" name="district_name" value="301" class="process">
                      <label for="html">Alappuzha</label><br>
                      <input type="radio" id="Ernakulam" name="district_name" value="307" class="process">
                      <label for="css">Ernakulam</label><br>
                      <input type="radio" id="Idukki" name="district_name" value="306" class="process">
                      <label for="javascript">Idukki</label><br>
                      <input type="radio" id="Kannur" name="district_name" value="297" class="process">
                      <label for="javascript">Kannur</label><br>
                      <input type="radio" id="Kasaragod" name="district_name" value="295" class="process">
                      <label for="javascript">Kasaragod</label><br>
                      <input type="radio" id="Kollam" name="district_name" value="298" class="process">
                      <label for="javascript">Kollam</label><br>
                      <input type="radio" id="Kottayam" name="district_name" value="304" class="process">
                      <label for="javascript">Kottayam</label><br>
                      <input type="radio" id="Kozhikode" name="district_name" value="305" class="process">
                      <label for="javascript">Kozhikode</label><br>
                      <input type="radio" id="Malappuram" name="district_name" value="302" class="process">
                      <label for="javascript">Malappuram</label><br>
                      <input type="radio" id="Palakkad" name="district_name" value="308" class="process">
                      <label for="javascript">Palakkad</label><br>
                      <input type="radio" id="Pathanamthitta" name="district_name" value="300" class="process">
                      <label for="javascript">Pathanamthitta</label><br>
                      <input type="radio" id="Thiruvananthapuram" name="district_name" value="296" class="process">
                      <label for="javascript">Thiruvananthapuram</label><br>
                      <input type="radio" id="Thrissur" name="district_name" value="303" class="process">
                      <label for="javascript">Thrissur</label><br>
                      <input type="radio" id="Wayanad" name="district_name" value="299" class="process">
                      <label for="javascript">Wayanad</label><br>
                </div>
                <div class="col-md-2 col-sm-6 col-xs-6">
                      <input type="radio" class="all" name="min_age_limit" checked="checked" value="">
                      <label for="html"> All </label><br>
                      <input type="radio" id="18" name="min_age_limit" value="18" >
                      <label for="html"> 18 & Above </label><br>
                      <input type="radio" id="18" name="min_age_limit" value="18" >
                      <label for="css"> 18-44 Only</label><br>
                      <input type="radio" id="45" name="min_age_limit" value="45" >
                      <label for="javascript"> 45 & Above </label><br>
                </div> 
                <div class="col-md-2 col-sm-6 col-xs-6">
                      <input type="radio" class="all" name="vaccine" value="" checked="checked">
                      <label for="javascript">All</label><br>
                      <input type="radio" id="Covishield" name="vaccine" value="COVISHIELD" >
                      <label for="javascript">Covishield</label><br>
                      <input type="radio" id="Covaxin" name="vaccine" value="COVAXIN" >
                      <label for="javascript">Covaxin</label><br>
                      <input type="radio" id="SputnikV" name="vaccine" value="SPUTNIK V" >
                      <label for="javascript">Sputnik V</label><br>
                </div>
                <div class="col-md-2 col-sm-6 col-xs-6">
                      <input type="radio" class="any" name="fee_type" value="" checked="checked">
                      <label for="javascript">Any</label><br>
                      <input type="radio" id="Free" name="fee_type" value="Free" >
                      <label for="javascript">Free</label><br>
                      <input type="radio" id="Paid" name="fee_type" value="Paid" >
                      <label for="javascript">Paid</label><br>
                </div>
                <div class="col-md-2 col-sm-6 col-xs-6">
                      <input type="radio" class="all" name="available_capacity_dose" value="" checked="checked">
                      <label for="javascript">Any</label><br>
                      <input type="radio" id="dose1" name="available_capacity_dose" value="1" >
                      <label for="javascript">Dose1</label><br>
                      <input type="radio" id="dose2" name="available_capacity_dose" value="2" >
                      <label for="javascript">Dose2</label><br>
                </div>
                <div class="col-md-2 col-sm-6 col-xs-6">
                    <div>
                          <input type="radio" id="today" name="check_date" value="" >
                          <label for="javascript">Today</label><br>
                          <input type="radio" id="tommorrow" name="check_date" value="" checked="checked" >
                          <label for="javascript">Tommorrow</label><br>
                          <input type="radio" id="dayafter" name="check_date" value="" >
                          <label for="javascript">Dayafter</label><br>
                        <div class="m-2">
                            <label>Pincode</label>
                            <input id="pincode"  name="pincode" type="text" placeholder="eg: 695001,695002,695003" />
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <div class="col-md-12 text-center" id="div_placeholder">

        </div>
    </body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
    <script>
        $('body').on('change', '.process', function (e) {
            clearInterval(reloader);
            process();
            var reloader = setInterval(function () {
                var district_name = document.querySelector('input[name="district_name"]:checked').value;
                if (district_name) {
                    process();
                }
            }, 5000);
            e.preventDefault();
        });

        var currentDate = new Date();
        currentDate.setDate(currentDate.getDate());
        var today = ("0" + currentDate.getDate()).slice(-2) + "-" + ("0" + (currentDate.getMonth() + 1)).slice(-2) + "-" + currentDate.getFullYear();
        currentDate.setDate(currentDate.getDate() + 1);
        var tommorrow = ("0" + currentDate.getDate()).slice(-2) + "-" + ("0" + (currentDate.getMonth() + 1)).slice(-2) + "-" + currentDate.getFullYear();
        currentDate.setDate(currentDate.getDate() + 1);
        var dayafter = ("0" + currentDate.getDate()).slice(-2) + "-" + ("0" + (currentDate.getMonth() + 1)).slice(-2) + "-" + currentDate.getFullYear();
        $('#today').val(today);
        $('#tommorrow').val(tommorrow);
        $('#dayafter').val(dayafter);

        var playsound = 0;
        function process() {
            var district_name = document.querySelector('input[name="district_name"]:checked').value;
            var district_disp = document.querySelector('input[name="district_name"]:checked').id;
            var vaccine = document.querySelector('input[name="vaccine"]:checked').value;
            var min_age_limit = document.querySelector('input[name="min_age_limit"]:checked').value;
            var fee_type = document.querySelector('input[name="fee_type"]:checked').value;
            var available_capacity_dose = document.querySelector('input[name="available_capacity_dose"]:checked').value;
            var check_date = document.querySelector('input[name="check_date"]:checked').value;
            var pincode = document.querySelector('input[name="pincode"]').value;
            var pincodeArr = pincode.split(',');
            var overallList = 0;
            var path = 'https://cdn-api.co-vin.in/api/v2/appointment/sessions/public/findByDistrict?district_id=' + district_name + '&date=' + check_date;
            $.ajax({
                url: path,
                type: "GET",
                success: function (response) {
                    var sessions = response.sessions;
                    var table = '<h2>Checking slot availability for ' + district_disp + ' on ' + check_date + ' <a target="_blank" href="https://selfregistration.cowin.gov.in/selfregistration"><button class="btn btn-sm btn-primary">Go to Cowin Self Registration</button></a></h2> Refreshing in <span id="timer"></span>';
                    table += '<table border="1" style="width:100%" class="table table-responsive">';
                    table += '<tr>';
                    table += '<th>Sl No.</th>';
                    table += '<th>Min. Age</th>';
                    table += '<th>Fee Type</th>';
                    table += '<th>Vaccine</th>';
                    table += '<th>Dose 1</th>';
                    table += '<th>Dose 2</th>';
                    table += '<th>Session</th>';
                    table += '<th>Center Name</th>';
                    table += '<th>Pincode</th>';
                    table += '</tr>';
                    var i = 1;
                    var availability_count = 0;
                    for (const resp of sessions) {
                        if (!vaccine || vaccine === resp.vaccine) {
                            if (!fee_type || fee_type === resp.fee_type) {
                                if (((!available_capacity_dose && (resp.available_capacity_dose1 > 1 || resp.available_capacity_dose2 > 1)) || ((available_capacity_dose == 1 && resp.available_capacity_dose1 > 1) || (available_capacity_dose == 2 && resp.available_capacity_dose2 > 1))) || overallList == 1) {
                                    if (!pincode || pincodeArr.includes(String(resp.pincode))) {
                                        if (!min_age_limit || min_age_limit === resp.min_age_limit) {
                                            table += '<tr>';
                                            table += '<td>' + i + '</td>';
                                            table += '<td>' + resp.min_age_limit + '</td>';
                                            table += '<td>' + resp.fee_type + '</td>';
                                            table += '<td>' + resp.vaccine + '</td>';
                                            table += '<td>' + resp.available_capacity_dose1 + '</td>';
                                            table += '<td>' + resp.available_capacity_dose2 + '</td>';
                                            table += '<td>' + resp.from + '-' + resp.to + '</td>';
                                            table += '<td>' + resp.name + '</td>';
                                            table += '<td>' + resp.pincode + '</td>';
                                            table += '</tr>';
                                            i = i + 1;
                                            availability_count = availability_count + 1;
                                            playsound = 1;
                                        }
                                    }
                                }
                            }
                        }
                    }
                    startCount();
                    if (sessions.length < 1 || availability_count === 0) {
                        table += '<tr><td colspan="9">No Slots Available</td></tr>';
                        $('#div_placeholder').html('');
                        $('#div_placeholder').html(table);
                        return false;
                    }
                    if (playsound === 1) {
                        var myAudio = new Audio('buzzer.wav');
                        myAudio.play();
                    }
                    table += '</table>';
                    $('#div_placeholder').html('');
                    $('#div_placeholder').html(table);
                }
            });

        }

        function startCount() {
            var c = 5;
            var timer = setInterval(function () {
                if (c <= 1) {
                    clearInterval(timer);
                }
                document.getElementById("timer").innerHTML = c;
                c = c - 1;
            }, 1000);
        }

        var video = document.createElement('video');
        video.setAttribute('loop', '');
        video.setAttribute('style', 'position: fixed;');
        function addSourceToVideo(element, type, dataURI) {
            var source = document.createElement('source');
            source.src = dataURI;
            source.type = 'video/' + type;
            element.appendChild(source);
        }
        var base64 = function (mimeType, base64) {
            return 'data:' + mimeType + ';base64,' + base64;
        };
        addSourceToVideo(video, 'webm', base64('video/webm', 'GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA='));
        addSourceToVideo(video, 'mp4', base64('video/mp4', 'AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAAG21kYXQAAAGzABAHAAABthADAowdbb9/AAAC6W1vb3YAAABsbXZoZAAAAAB8JbCAfCWwgAAAA+gAAAAAAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIVdHJhawAAAFx0a2hkAAAAD3wlsIB8JbCAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAIAAAACAAAAAABsW1kaWEAAAAgbWRoZAAAAAB8JbCAfCWwgAAAA+gAAAAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAVxtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAEcc3RibAAAALhzdHNkAAAAAAAAAAEAAACobXA0dgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAIAAgASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAAFJlc2RzAAAAAANEAAEABDwgEQAAAAADDUAAAAAABS0AAAGwAQAAAbWJEwAAAQAAAAEgAMSNiB9FAEQBFGMAAAGyTGF2YzUyLjg3LjQGAQIAAAAYc3R0cwAAAAAAAAABAAAAAQAAAAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAAEwAAAAEAAAAUc3RjbwAAAAAAAAABAAAALAAAAGB1ZHRhAAAAWG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAK2lsc3QAAAAjqXRvbwAAABtkYXRhAAAAAQAAAABMYXZmNTIuNzguMw=='));
        document.body.appendChild(video);
        var playFn = function () {
            video.play();
            document.body.removeEventListener('touchend', playFn);
        };
        document.body.addEventListener('touchend', playFn);
    </script>
</html>


